<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pop! - Carnival Balloon Game</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div id="game">
    <header>
      <div id="coins" class="counter">💰 <span id="coinCount">0</span>
        <a href="https://www.charitywater.org/" target="_blank" rel="noopener noreferrer" title="Visit Charity: water"><img src="/assets/logo.png" alt="Game logo - Charity: water" id="coinLogo"></a>
</div>
      <div class="header-right">
  <button id="storeToggle" aria-expanded="false" aria-controls="shop" class="storeToggle smallBtn" aria-label="Open store"><span class="btn-emoji">🛍️</span><span class="btn-label">Store</span></button>
  <button id="resetBtn" class="storeToggle smallBtn" aria-label="Reset game"><span class="btn-emoji">🔁</span><span class="btn-label">Reset</span></button>
  <button id="tutorialBtn" class="storeToggle smallBtn" aria-label="Open tutorial"><span class="btn-emoji">❓</span><span class="btn-label">Tutorial</span></button>
      </div>
      <div id="topCenter">
        <div id="gameTitle">Pop!</div>
        <div id="progress">
          <div id="waterBar" class="bar water"></div>
          <div id="poisonBar" class="bar poison"></div>
        </div>
      </div>
    </header>

    <!-- Top center title and progress (moved into header) -->
    <div id="highscore">High: <span id="highscoreVal">0</span></div>

    <main>
      <div id="board" aria-label="Game board"></div>
      <aside id="shop" aria-hidden="true">
        <button id="closeShop" aria-label="Close store">✕</button>
        <h2>Shop</h2>
        <div class="shop-item" data-weapon="darts">
          <div class="emoji">🎯</div>
          <div>
            <div class="name">Darts</div>
            <div class="price">Refill: 5 coins</div>
            <button class="buy" data-type="darts">Buy Refill</button>
          </div>
        </div>

        <div class="shop-item" data-weapon="arrows">
          <div class="emoji">🏹</div>
          <div>
            <div class="name">Arrows</div>
            <div class="price">Buy: 150 | Refill: 50</div>
            <button class="buy" data-type="arrows">Buy</button>
            <button class="buy-refill" data-type="arrows">Refill</button>
          </div>
        </div>

        <div class="shop-item" data-weapon="shuriken">
          <div class="emoji">🌀</div>
          <div>
            <div class="name">Shuriken</div>
            <div class="price">Buy: 250 | Refill: 75</div>
            <button class="buy" data-type="shuriken">Buy</button>
            <button class="buy-refill" data-type="shuriken">Refill</button>
          </div>
        </div>

        <div class="shop-item" data-weapon="kunai">
          <div class="emoji">🔪</div>
          <div>
            <div class="name">Kunai</div>
            <div class="price">Buy: 500 | Refill: 150</div>
            <button class="buy" data-type="kunai">Buy</button>
            <button class="buy-refill" data-type="kunai">Refill</button>
          </div>
        </div>

      </aside>
    </main>

    <footer>
      <div id="weaponDisplay">Weapon: <span id="weaponIcon">🎯</span> <span id="weaponName">Darts</span></div>

      <!-- Mobile / touch controls placed with the footer so they share the same area -->
      <div id="controls" role="toolbar" aria-label="Game controls" style="margin-top:8px;">
        <div id="weaponsBar" role="group" aria-label="Weapons">
          <button class="wbtn" data-weapon="darts" aria-label="Select darts">1 🎯</button>
          <button class="wbtn" data-weapon="arrows" aria-label="Select arrows">2 🏹</button>
          <button class="wbtn" data-weapon="shuriken" aria-label="Select shuriken">3 🌀</button>
          <button class="wbtn" data-weapon="kunai" aria-label="Select kunai">4 🔪</button>
        </div>
        <div id="actionBar" role="group" aria-label="Actions">
          <button id="refillBtn" aria-label="Refill current weapon">Refill (R)</button>
        </div>
      </div>

      <div id="ammo" class="counter">Ammo: <span id="ammoCount">5</span></div>
    </footer>

    <div id="overlay" class="hidden">
      <div id="message">
        <h2 id="messageTitle">You Win!</h2>
        <p id="messageText"></p>
        <div class="buttons">
          <button id="replayBtn">Play Again</button>
          <button id="exitBtn">Exit</button>
        </div>
      </div>
    </div>
    <!-- WebAudio will provide synthesized sounds (no external files required) -->

    

    <!-- Home modal: Start or view Tutorial -->
    <div id="homeModal" class="overlay-modal">
      <div class="modal">
        <h2>Welcome to Pop!</h2>
        <p>Pop colorful carnival balloons — collect coins, avoid poison, and fill the water meter to win.</p>
        <div class="modal-actions">
          <button id="startBtn">Start Game</button>
          <button id="readBtn">Tutorial</button>
        </div>
      </div>
    </div>

    <!-- Tutorial content modal (opened from Home) -->
    <div id="tutorial" class="overlay-modal hidden">
      <div class="modal">
        <h2>Tutorial</h2>
        <ol>
          <li>Tap balloons to pop them. Water increases your water gauge, poison increases poison, coins give coins and +10 score.</li>
          <li>Chaining water/poison doubles consecutive effects up to a cap.</li>
          <li>Use coins to buy/refill weapons in the Store (open via the Store button).</li>
          <li>When you run out of ammo and can't afford refills you lose. Reach the water gauge to win.</li>
        </ol>
        <div class="modal-actions">
          <button id="backFromTutorial">Back</button>
          <button id="startFromTutorial">Start Game</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Simple site footer beneath the game board -->
  <footer id="externalFooter" style="width:100%; display:flex; justify-content:center; padding:12px 0; background:transparent;">
    <a href="https://www.charitywater.org/" target="_blank" rel="noopener noreferrer" title="Visit charity: water" style="display:flex; align-items:center; gap:10px; text-decoration:none; color:inherit; font-family:'Myriad Pro', 'Segoe UI', Arial, sans-serif;">
      <img src="/assets/logo.png" alt="charity: water logo" style="height:28px; width:auto; display:inline-block; vertical-align:middle;">
      <div style="display:flex; flex-direction:column; line-height:1;">
        <span style="font-weight:700; font-size:14px;">charity: water</span>
        <span style="font-size:12px; color:#6b7280;">bringing clean water to communities</span>
      </div>
    </a>
  </footer>

  <script src="script.js"></script>
</body>
</html>